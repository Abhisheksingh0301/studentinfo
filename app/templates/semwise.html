{% extends "layout.html" %}

{% block title %}Student Information system{% endblock %}

{% block content %}

<div class="flex justify-between items-center mb-8 print:hidden">
    <div>
        <h1 class="text-3xl font-bold text-gray-900">Semesterwise records</h1>
        <p class="text-gray-600 mt-2">Student Information system</p>
    </div>
</div>

<!-- Stats Card -->
<div class="bg-white p-6 rounded-lg shadow-md">
    <form method="POST">
        <div class="flex flex-col md:flex-row md:items-center md:space-x-6 space-y-4 md:space-y-0 print:hidden">

            <!-- Session Dropdown -->
            <div class="flex-1 flex flex-col">
                <label for="sessn" class="text-sm font-medium text-gray-600 mb-1">Session</label>
                <select name="sessn" id="sessn"
                    class="border border-gray-300 rounded-md p-2 text-gray-700 shadow focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="" disabled {% if not selected_sessn %}selected{% endif %}>-- Select Session --
                    </option>
                    {% for s in Sessn %}
                    <option value="{{ s }}" {% if selected_sessn==s %}selected{% endif %}>{{ s }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- Department Dropdown -->
            <div class="flex-1 flex flex-col">
                <label for="dept" class="text-sm font-medium text-gray-600 mb-1">Dept</label>
                <select name="dept" id="dept"
                    class="border border-gray-300 rounded-md p-2 text-gray-700 shadow focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="" disabled {% if not selected_dept %}selected{% endif %}>-- Select Department --
                    </option>
                    {% for d in Dept %}
                    <option value="{{ d }}" {% if selected_dept==d %}selected{% endif %}>{{ d }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- Submit Button -->
            <div class="flex-1 flex flex-col justify-end">
                <button type="submit"
                    class="w-full bg-blue-600 text-white py-2 px-4 mt-6 rounded-md shadow hover:bg-blue-700 transition">
                    Submit
                </button>
            </div>

        </div>
    </form>
    <div class="w-full max-w-6xl mt-4 rounded-lg shadow-md">
        {% if table is not none and not table.empty %}
        <hr class="border-t-2 border-gray-300 my-6">
        <h1 class="text-3xl font-bold text-gray-600 hover:text-gray-800 mt-16 text-center">
            Exam Marks Pivot Report
        </h1>
        <h2 class="text-lg text-gray-600 mb-8 text-center">
            Session: {{ selected_sessn }} â€¢ Department: {{ selected_dept }}
        </h2>
        <div class="overflow-x-auto bg-white rounded-lg shadow">
            <table class="min-w-full text-sm text-left text-gray-700 border-collapse">
                <thead class="bg-gray-100 text-gray-800 uppercase text-xs tracking-wider">
                    <tr>
                        {% for col in columns %}
                        <th class="px-4 py-3 border-b border-gray-300 text-center">{{ col }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in table %}
                    <tr class="hover:bg-gray-50 even:bg-gray-50">
                        {% for col in columns %}
                        <td class="px-4 py-2 border-b border-gray-200 text-center">{{ row[col] | fmt }}</td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="mt-4 flex justify-center space-x-4">
            {% set total_pages = (total_rows // per_page) + (1 if total_rows % per_page > 0 else 0) %}
            {% if page > 1 %}
            <a href="{{ url_for('main.semwise', page=page-1, sessn=selected_sessn, dept=selected_dept) }}"
                class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">Previous</a>
            {% endif %}
            <span class="px-4 py-2">Page {{ page }} of {{ total_pages }}</span>
            {% if page < total_pages %} <a
                href="{{ url_for('main.semwise', page=page+1, sessn=selected_sessn, dept=selected_dept) }}"
                class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">Next</a>
                {% endif %}

        </div>
        {% else %}
        <p class="text-center text-gray-500 mt-4">No data to display.</p>
        {% endif %}

    </div>
</div>

{% endblock %}